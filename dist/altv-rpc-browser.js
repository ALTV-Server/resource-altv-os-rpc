(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):(a=a||self,b(a.rpc={}))})(this,function(a){'use strict';function b(){const a=0|46656*Math.random(),b=0|46656*Math.random(),c=("000"+a.toString(36)).slice(-3),d=("000"+b.toString(36)).slice(-3);return c+d}function c(){if(!alt.Player)return"cef";return alt.Player.local?"client":alt.Player?"server":void 0}function d(a){const b=c();return JSON.stringify(a,(a,c)=>{if("client"===b||"server"===b&&c&&"object"==typeof c){let a;if(c instanceof alt.Player?a=J.Player:c instanceof alt.Vehicle&&(a=J.Vehicle),a)return{__t:a,i:c.id}}return c})}function e(a){const b=c();return JSON.parse(a,(a,c)=>{if(("client"===b||"server"===b)&&c&&"object"==typeof c&&"string"==typeof c.__t&&"number"==typeof c.i&&2===Object.keys(c).length){const a=c.i,b=c.__t;switch(b){case J.Player:return alt.Player.getByID(a);case J.Vehicle:return alt.Vehicle.getByID(a);}}return c})}function f(a,b){return"number"==typeof b?Promise.race([new Promise((a,c)=>{I(()=>c("TIMEOUT"),b)}),a]):a}function g(a){const b="__rpc:namespaces",c=(a,b)=>{if(!a.includes(b))return a.push(b),!0};if(H){const d=H[b]||[];if(!c(d,a))return!1;H[b]=d}else{const d=alt.Player.local;if(d){const e=d.getMeta(b),f=e?JSON.parse(e):[];if(!c(f,a))return!1;d.setMeta(b,JSON.stringify(f))}}return!0}function h(){c()}function i(a){if(V)throw"Already initialized.";if(!a)throw"Must specify a namespace.";if(!g(a))throw`Namespace "${a}" is already in use.`;h(),V=a;const b=j(M),c=j(O);alt.on(b,l),"server"===K&&alt.onClient(b,(a,b)=>l(b,a)),"client"===K&&(alt.onServer(b,l),o("__rpc:callServer",([a,b,c],d)=>r(a,b,{fenv:d.environment,noRet:c})),o("__rpc:callBrowsers",([a,b,c],d)=>w(null,a,b,{fenv:d.environment,noRet:c})),o(j(P),([a,b],d)=>{T.forEach(e=>{v(e,c,[a,b],{fenv:d.environment,noRet:1})})})),o(c,([a,b],c)=>z(a,b,c))}function j(a){return`${a}::${V}`}function k(){if(!V)throw new Error(`You must first call rpc.init() with a namespace.`)}function l(a,b,c){h();const f=e(a),g=j(M);if(f.req){const a={id:f.id,environment:f.fenv||f.env,player:b},e={ret:1,id:f.id,env:K};let h;switch(K){case"server":h=a=>alt.emitClient(b,g,a);break;case"client":{"server"===f.env?h=a=>alt.emitServer(g,a):"cef"===f.env&&(a.browser=c,h=a=>c&&c.valid&&c.emit(g,a));break}case"cef":h=a=>alt.emit(M,a);}if(h){const b=m(f.name,f.args,a);f.noRet||b.then(a=>h(d({...e,res:a}))).catch(a=>h(d({...e,err:null===a?null:a})))}}else if(f.ret){const a=R[f.id];if("server"===K&&a.player!==b)return;a&&(a.resolve(f.hasOwnProperty("err")?Promise.reject(f.err):f.res),delete R[f.id])}}async function m(a,b,c){const d=Q[a];if(!d)throw L;return d(b,c)}function n(a){if(k(),"client"!==K)throw"addWebView can only be used on the client";T.includes(a)||(a.on(M,b=>l(b,void 0,a)),a.on(N,b=>{U[b]=a}),T.push(a))}function o(a,b){if(2!==arguments.length)throw"register expects 2 arguments: \"name\" and \"cb\"";h(),"cef"===K&&alt.emit(N,a),Q[a]=b}function p(a){if(1!==arguments.length)throw"unregister expects 1 argument: \"name\"";Q[a]=void 0}function q(a,b,c={}){return 1>arguments.length||3<arguments.length?Promise.reject("call expects 1 to 3 arguments: \"name\", optional \"args\", and optional \"options\""):f(m(a,b,{environment:K}),c.timeout)}function r(a,c,e={}){switch(k(),K){case"server":return q(a,c);case"client":{const f=b();return new Promise(b=>{e.noRet||(R[f]={resolve:b});const g={req:1,id:f,name:a,env:K,args:c,...e};alt.emitServer(j(M),d(g))})}case"cef":return u("__rpc:callServer",[a,c,+e.noRet]);}}function s(a,b,c={}){if(k(),1>arguments.length||3<arguments.length)return Promise.reject("callServer expects 1 to 3 arguments: \"name\", optional \"args\", and optional \"options\"");let d={};return c.noRet&&(d.noRet=1),f(r(a,b,d),c.timeout)}function t(a,c,e,f={}){switch(k(),K){case"client":return q(c,e);case"server":{const g=b();return new Promise(b=>{f.noRet||(R[g]={resolve:b,player:a});const h={req:1,id:g,name:c,env:K,args:e,...f};alt.emitClient(a,j(M),d(h))})}case"cef":{const a=b();return new Promise(b=>{f.noRet||(R[a]={resolve:b});const g={req:1,id:a,name:c,env:K,args:e,...f};alt.emit(M,d(g))})}}}function u(a,b,c,d={}){switch(k(),K){case"client":{if(d=c||{},c=b,b=a,a=null,1>arguments.length||3<arguments.length||"string"!=typeof b)return Promise.reject("callClient from the client expects 1 to 3 arguments: \"name\", optional \"args\", and optional \"options\"");break}case"server":{if(2>arguments.length||4<arguments.length||"object"!=typeof a)return Promise.reject("callClient from the server expects 2 to 4 arguments: \"player\", \"name\", optional \"args\", and optional \"options\"");break}case"cef":{if(d=c||{},c=b,b=a,a=null,1>arguments.length||3<arguments.length||"string"!=typeof b)return Promise.reject("callClient from the browser expects 1 to 3 arguments: \"name\", optional \"args\", and optional \"options\"");break}}let e={};return d.noRet&&(e.noRet=1),f(t(a,b,c,e),d.timeout)}function v(a,c,e,f={}){return a&&a.valid?(k(),new Promise(g=>{const h=b();f.noRet||(R[h]={resolve:g});const i={req:1,id:h,name:c,env:K,args:e,...f};a.emit(j(M),d(i))})):Promise.reject("INVALID_BROWSER")}function w(a,b,c,d={}){switch(k(),K){case"client":const e=U[b];return e&&e.valid?v(e,b,c,d):Promise.reject(L);case"server":return t(a,"__rpc:callBrowsers",[b,c,+d.noRet],d);case"cef":return t(null,"__rpc:callBrowsers",[b,c,+d.noRet],d);}}function x(a,b,c,d={}){k();let e,g={};switch(K){case"client":case"cef":if(d=c||{},c=b,b=a,1>arguments.length||3<arguments.length)return Promise.reject("callBrowsers from the client or browser expects 1 to 3 arguments: \"name\", optional \"args\", and optional \"options\"");d.noRet&&(g.noRet=1),e=w(null,b,c,g);break;case"server":if(2>arguments.length||4<arguments.length)return Promise.reject("callBrowsers from the server expects 2 to 4 arguments: \"player\", \"name\", optional \"args\", and optional \"options\"");d.noRet&&(g.noRet=1),e=w(a,b,c,g);}if(e)return f(e,d.timeout)}function y(a,b,c,d={}){if("client"!==K)return Promise.reject("callBrowser can only be used in the client environment");if(2>arguments.length||4<arguments.length)return Promise.reject("callBrowser expects 2 to 4 arguments: \"browser\", \"name\", optional \"args\", and optional \"options\"");k();let e={};return d.noRet&&(e.noRet=1),f(v(a,b,c,e),d.timeout)}function z(a,b,c){const d=S[a];d&&d.forEach(a=>a(b,c))}function A(a,b){if(2!==arguments.length)throw"on expects 2 arguments: \"name\" and \"cb\"";const c=S[a]||new Set;c.add(b),S[a]=c}function B(a,b){if(2!==arguments.length)throw"off expects 2 arguments: \"name\" and \"cb\"";const c=S[a];c&&c.delete(b)}function C(a,b){if(1>arguments.length||2<arguments.length)throw"trigger expects 1 or 2 arguments: \"name\", and optional \"args\"";z(a,b,{environment:K})}function D(a,b,c){switch(k(),K){case"client":{if(c=b,b=a,a=null,1>arguments.length||2<arguments.length||"string"!=typeof b)throw"triggerClient from the client expects 1 or 2 arguments: \"name\", and optional \"args\"";break}case"server":{if(2>arguments.length||3<arguments.length||"object"!=typeof a)throw"triggerClient from the server expects 2 or 3 arguments: \"player\", \"name\", and optional \"args\"";break}case"cef":{if(c=b,b=a,a=null,1>arguments.length||2<arguments.length||"string"!=typeof b)throw"triggerClient from the browser expects 1 or 2 arguments: \"name\", and optional \"args\"";break}}t(a,j(O),[b,c],{noRet:1})}function E(a,b){if(1>arguments.length||2<arguments.length)throw"triggerServer expects 1 or 2 arguments: \"name\", and optional \"args\"";k(),r(j(O),[a,b],{noRet:1})}function F(a,b,c){switch(K){case"client":case"cef":if(c=b,b=a,a=null,1>arguments.length||2<arguments.length)throw"triggerBrowsers from the client or browser expects 1 or 2 arguments: \"name\", and optional \"args\"";break;case"server":if(2>arguments.length||3<arguments.length)throw"triggerBrowsers from the server expects 2 or 3 arguments: \"player\", \"name\", and optional \"args\"";}k(),t(a,j(P),[b,c],{noRet:1})}function G(a,b,c){if("client"!==K)throw"callBrowser can only be used in the client environment";if(2>arguments.length||4<arguments.length)throw"callBrowser expects 2 or 3 arguments: \"browser\", \"name\", and optional \"args\"";k(),v(a,j(O),[b,c],{noRet:1})}const H=function(){if("undefined"!=typeof global)return global;return"undefined"==typeof window?void 0:window}(),I=alt.setTimeout||H.setTimeout;var J;(function(a){a.Player="pl",a.Vehicle="v"})(J||(J={}));const K=c();if(!K)throw"Unknown alt:V environment";const L="PROCEDURE_NOT_FOUND",M="__rpc:process",N="__rpc:browserRegister",O="__rpc:triggerEvent",P="__rpc:triggerEventBrowsers",Q={},R={},S={},T=[],U={};let V="";a.addWebView=n,a.call=q,a.callBrowser=y,a.callBrowsers=x,a.callClient=u,a.callServer=s,a.default={init:i,addWebView:n,register:o,unregister:p,call:q,callServer:s,callClient:u,callBrowsers:x,callBrowser:y,on:A,off:B,trigger:C,triggerServer:E,triggerClient:D,triggerBrowsers:F,triggerBrowser:G},a.init=i,a.off=B,a.on=A,a.register=o,a.trigger=C,a.triggerBrowser=G,a.triggerBrowsers=F,a.triggerClient=D,a.triggerServer=E,a.unregister=p,Object.defineProperty(a,"__esModule",{value:!0})});
